---
task_number: 007
title: Testing Suite
status: backlog
epic: pharmaceutical-campaign-automation
depends_on: [4, 005, 7]
parallel: false
created: 2025-09-15T06:17:01Z
estimated_hours: 16
priority: high
---

# Task 007: Testing Suite

## Overview

Implement comprehensive testing suite for the pharmaceutical campaign automation platform, covering all 7 agents, LangGraph workflow, frontend components, and performance validation. Tests must be designed to reveal flaws and provide verbose debugging information.

## Acceptance Criteria

### Unit Tests for All 7 Agents
- **Agent Testing Framework**: pytest-based test suite with pharmaceutical mock data fixtures
- **Individual Agent Validation**: Test each agent (1-6) with realistic pharmaceutical inputs
- **Master Orchestrator Testing**: Comprehensive LangGraph workflow state machine validation
- **Timing Enforcement**: Validate execution time requirements per agent specifications
- **Error Handling**: Test failure scenarios and recovery mechanisms
- **Mock Data Integration**: Test with realistic therapeutic area data (diabetes, oncology, cardiology, neurology, dermatology, psychiatry)

### Integration Tests for Complete LangGraph Workflow
- **End-to-End Campaign Creation**: Test complete workflow from natural language input to campaign output
- **Agent-to-Agent Communication**: Validate A2A communication protocol between agents
- **State Persistence**: Test LangGraph state management across agent transitions
- **Workflow Recovery**: Test system recovery from individual agent failures
- **Concurrent Processing**: Validate 5 concurrent campaign processing capability
- **Database Integration**: Test SQLite operations with complete audit trail validation

### Frontend Testing with Streamlit Testing Framework
- **UI Component Testing**: Test all Streamlit components and state management
- **Real-time Updates**: Validate progress indicators and status polling functionality
- **Error Boundary Testing**: Test graceful degradation and retry mechanisms
- **Mobile Responsiveness**: Validate UI on tablet and smartphone viewport sizes
- **Session State Management**: Test workflow progress tracking and persistence
- **API Integration**: Test frontend-backend communication patterns

### Performance Tests Validating Timing Requirements
- **Agent Execution Timing**: Validate each agent meets timing specifications:
  - Marketing Intelligence Agent ≤30s
  - Content Generation Agent ≤60s
  - Content Organization Agent ≤30s
  - Veeva Integration Agent ≤45s
  - Audience Targeting Agent ≤60s
  - Campaign Activation Agent ≤45s
- **Total Workflow Performance**: Complete workflow execution ≤ few minutes
- **API Response Times**: Non-agent endpoints <200ms response time
- **Concurrent Load Testing**: 5 simultaneous campaigns without degradation
- **Memory Usage Monitoring**: Resource leak detection and cleanup validation

### End-to-End Workflow Validation
- **Demo Scenario Testing**: "Create diabetes campaign for Texas endocrinologists" complete workflow
- **Input Validation Testing**: Pharmaceutical keyword extraction and validation accuracy
- **Output Quality Assurance**: Generated content includes proper medical disclaimers
- **Compliance Audit Trail**: Complete tracking of all agent executions and state transitions
- **Geographic and Specialty Targeting**: HCP database filtering accuracy validation
- **Campaign Metrics Generation**: Historical performance analysis and recommendations

### Error Recovery Testing
- **Agent Failure Recovery**: Individual agent timeout and failure handling
- **Database Connection Issues**: SQLite connection failure and recovery scenarios
- **Invalid Input Handling**: Non-pharmaceutical inputs and malformed requests
- **Resource Exhaustion**: Memory and CPU limit testing with graceful degradation
- **Network Simulation**: Mock API failure scenarios and fallback mechanisms
- **State Corruption Recovery**: LangGraph state validation and repair mechanisms

## Technical Implementation

### Testing Infrastructure
```python
# pytest configuration with pharmaceutical fixtures
@pytest.fixture
def pharmaceutical_mock_data():
    return {
        "therapeutic_areas": ["diabetes", "oncology", "cardiology"],
        "target_specialties": ["endocrinology", "oncology", "cardiology"],
        "geographic_regions": ["Texas", "California", "New York"],
        "hcp_database": generate_mock_hcp_data(1000)
    }

@pytest.fixture
def langgraph_test_state():
    return initialize_test_workflow_state()

@pytest.fixture
def streamlit_test_app():
    return create_test_streamlit_instance()
```

### Test Categories
1. **Unit Tests** (`tests/unit/`):
   - `test_agents/` - Individual agent testing with mock data
   - `test_orchestrator/` - Master Orchestrator LangGraph validation
   - `test_models/` - Pydantic model validation and pharmaceutical compliance
   - `test_database/` - SQLite operations and audit trail functionality

2. **Integration Tests** (`tests/integration/`):
   - `test_workflow/` - Complete LangGraph workflow execution
   - `test_api/` - FastAPI endpoint integration with agent orchestration
   - `test_frontend/` - Streamlit component integration with backend APIs

3. **Performance Tests** (`tests/performance/`):
   - `test_timing/` - Agent execution time validation
   - `test_load/` - Concurrent campaign processing capability
   - `test_resources/` - Memory usage and resource leak detection

4. **End-to-End Tests** (`tests/e2e/`):
   - `test_scenarios/` - Complete pharmaceutical campaign creation workflows
   - `test_compliance/` - Pharmaceutical compliance and audit trail validation

### Test Execution Commands
```bash
# Run all tests with verbose output for debugging
pytest tests/ -v --tb=long --capture=no

# Run performance tests specifically
pytest tests/performance/ -v --benchmark-only

# Run integration tests with mock pharmaceutical data
pytest tests/integration/ -v --mock-mode=true

# Generate test coverage report
pytest tests/ --cov=src --cov-report=html
```

### Continuous Integration
- **GitHub Actions Integration**: Automated test execution on pull requests
- **Test Coverage Requirements**: Minimum 90% code coverage for all agents
- **Performance Benchmarking**: Automated timing validation in CI pipeline
- **Pharmaceutical Compliance Checks**: Automated validation of medical disclaimers

## Dependencies

**Blocking Dependencies:**
- Task 004: Specialized Agents Implementation (requires all 6 agents completed)
- Task 005: Frontend Integration (requires Streamlit UI and real-time updates)
- Task 006: Validation System (requires input parsing and compliance checks)

**Technical Dependencies:**
- Completed LangGraph Master Orchestrator with A2A communication
- Functional pharmaceutical mock data system with realistic HCP databases
- Deployed FastAPI backend with all agent endpoints operational
- Streamlit frontend with progress tracking and error handling

## Definition of Done

- [ ] All 7 agents have comprehensive unit tests with pharmaceutical mock data
- [ ] Complete LangGraph workflow integration tests with state persistence validation
- [ ] Streamlit frontend testing framework with mobile responsiveness validation
- [ ] Performance tests validate all timing requirements under concurrent load
- [ ] End-to-end workflow validation with "diabetes campaign for Texas endocrinologists" scenario
- [ ] Error recovery testing covers agent failures, timeouts, and resource exhaustion
- [ ] Test coverage minimum 90% with verbose debugging output for all failures
- [ ] CI/CD pipeline integration with automated pharmaceutical compliance validation
- [ ] Performance benchmarking results document agent execution times and system limits
- [ ] Test documentation includes pharmaceutical testing scenarios and mock data usage

## Notes

- Tests must be designed to reveal flaws, not just pass - use realistic pharmaceutical scenarios
- Verbose test output required for debugging agent execution and LangGraph state transitions
- Mock pharmaceutical data must be comprehensive enough to test edge cases and compliance scenarios
- Performance tests should identify bottlenecks in agent execution and workflow orchestration
- Error recovery tests critical for pharmaceutical compliance and audit trail requirements
